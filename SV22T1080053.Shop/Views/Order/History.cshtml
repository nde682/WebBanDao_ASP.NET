@model IEnumerable<SV22T1080053.DomainModels.Order>
@{
    ViewData["Title"] = "Lịch sử đơn hàng";
}

<div class="container py-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="mb-0">Lịch sử mua hàng</h1>
        <a href="~/Shop" class="btn btn-primary rounded-pill">
            <i class="fa fa-shopping-bag me-2"></i> Tiếp tục mua sắm
        </a>
    </div>

    @if (Model != null && Model.Any())
    {
        <div class="card shadow-sm border-0">
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0 align-middle">
                        <thead class="bg-light text-nowrap">
                            <tr>
                                <th class="ps-4 py-3">Mã đơn</th>
                                <th class="py-3">Địa chỉ giao hàng</th>
                                <th class="py-3">Thông tin vận chuyển</th>
                                <th class="py-3">Tiến độ thời gian</th>
                                <th class="py-3">Trạng thái</th>
                                <th class="text-end pe-4 py-3">Thao tác</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="ps-4">
                                        <span class="fw-bold text-primary">#@item.OrderID</span><br />
                                        <small class="text-muted">Đặt: @item.OrderTime.ToString("dd/MM/yyyy HH:mm")</small>
                                    </td>

                                    <td>
                                        <div style="max-width: 200px; white-space: normal;">
                                            <span class="fw-bold">@item.DeliveryProvince</span><br />
                                            <small class="text-muted">@item.DeliveryAddress</small>
                                        </div>
                                    </td>

                                    <td>
                                        @if (!string.IsNullOrEmpty(item.ShipperName))
                                        {
                                            <span><i class="fa fa-user-tag me-1 text-info"></i>Ship: @item.ShipperName</span>
                                
                                            <br />
                                            @if (!string.IsNullOrEmpty(item.ShipperPhone))
                                            {
                                                <small class="text-muted"><i class="fa fa-phone me-1"></i>@item.ShipperPhone</small>
                                            }
                                        }
                                        else
                                        {
                                            <small class="text-muted fst-italic">-- Chưa phân công --</small>
                                        }
                                    </td>

                                    <td class="small">
                                        @if (item.AcceptTime.HasValue)
                                        {
                                            <div><i class="fa fa-check-square me-1 text-primary"></i>Duyệt: @item.AcceptTime.Value.ToString("dd/MM/yy HH:mm")</div>
                                        }
                                        @if (item.ShippedTime.HasValue)
                                        {
                                            <div><i class="fa fa-truck me-1 text-warning"></i>Giao: @item.ShippedTime.Value.ToString("dd/MM/yy HH:mm")</div>
                                        }
                                        @if (item.FinishedTime.HasValue)
                                        {
                                            <div class="text-success fw-bold"><i class="fa fa-flag-checkered me-1"></i>Xong: @item.FinishedTime.Value.ToString("dd/MM/yy HH:mm")</div>
                                        }
                                    </td>

                                    <td>
                                        @if (item.Status == Constants.ORDER_INIT)
                                        {
                                            <span class="badge bg-secondary rounded-pill">Chờ xác nhận</span>
                                        }
                                        else if (item.Status == Constants.ORDER_ACCEPTED)
                                        {
                                            <span class="badge bg-info text-dark rounded-pill">Đang đóng gói</span>
                                        }
                                        else if (item.Status == Constants.ORDER_SHIPPING)
                                        {
                                            <span class="badge bg-warning text-dark rounded-pill">Đang giao hàng</span>
                                        }
                                        else if (item.Status == Constants.ORDER_FINISHED)
                                        {
                                            <span class="badge bg-success rounded-pill">Hoàn tất</span>
                                        }
                                        else if (item.Status == Constants.ORDER_CANCEL || item.Status == Constants.ORDER_REJECTED)
                                        {
                                            <span class="badge bg-danger rounded-pill">Đã hủy/Từ chối</span>
                                        }
                                    </td>

                                    <td class="text-end pe-4">
                                        <a href="~/Order/Details/@item.OrderID" class="btn btn-sm btn-outline-primary rounded-pill px-3">
                                            Xem chi tiết
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <div class="mb-4">
                <i class="fa fa-box-open text-muted" style="font-size: 80px;"></i>
            </div>
            <h3 class="text-secondary">Bạn chưa có đơn hàng nào</h3>
            <a href="~/Shop" class="btn btn-primary rounded-pill px-5 py-3 mt-3">Đến Cửa Hàng Ngay</a>
        </div>
    }
</div>